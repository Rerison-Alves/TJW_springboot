<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/mystyle.css">
    <title>Pagina Principal</title>
</head>
<body>
<div class="top-bar">
    <h2>Sistema TJW</h2>
</div>
<div class="container" style="text-align:center; width: auto">
    <h1>Usuários</h1>

    <!-- Formulário de Filtros -->
    <form th:action="@{/usuarios}" method="get" style="display: flex; flex-direction: column; gap: 10px;">

        <!-- Primeira linha: 4 campos -->
        <div style="display: flex; gap: 10px;">
            <div style="display: flex; flex-direction: column; flex: 1 1 25%; min-width: 150px;">
                <label for="nome">Nome</label>
                <input type="text" id="nome" name="nome" placeholder="Insira nome" th:value="${nome}" style="padding: 8px;">
            </div>

            <div style="display: flex; flex-direction: column; flex: 1 1 25%; min-width: 150px;">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="Insira email" th:value="${email}" style="padding: 8px;">
            </div>

            <div style="display: flex; flex-direction: column; flex: 1 1 25%; min-width: 150px;">
                <label for="cpf">CPF</label>
                <input type="text" id="cpf" name="cpf" placeholder="Insira CPF" th:value="${cpf}" style="padding: 8px;">
            </div>

            <div style="display: flex; flex-direction: column; flex: 1 1 25%; min-width: 150px;">
                <label for="raca">Raça</label>
                <select id="raca" name="raca" th:value="${raca}" style="padding: 8px;">
                    <option value="" selected>N/a</option>
                    <option value="BRANCA">Branca</option>
                    <option value="PRETA">Preta</option>
                    <option value="PARDA">Parda</option>
                    <option value="AMARELA">Amarela</option>
                    <option value="INDIGENA">Indígena</option>
                    <option value="OUTRA">Outra</option>
                </select>
            </div>
        </div>

        <!-- Segunda linha: 2 campos de data + botão -->
        <div style="display: flex; gap: 10px;">
            <div style="display: flex; flex-direction: column; flex: 1 1 33.33%; min-width: 150px;">
                <label for="dtNascInit">Nascimento início</label>
                <input type="date" id="dtNascInit" name="dtNascInit" th:value="${dtNascInit}" style="padding: 8px;">
            </div>

            <div style="display: flex; flex-direction: column; flex: 1 1 33.33%; min-width: 150px;">
                <label for="dtNascFinal">Nascimento fim</label>
                <input type="date" id="dtNascFinal" name="dtNascFinal" th:value="${dtNascFinal}" style="padding: 8px;">
            </div>

            <div style="display: flex; flex-direction: column; flex: 1 1 33.33%; min-width: 150px;">
                <label>&nbsp;</label> <!-- Alinhamento com campos acima -->
                <button type="submit" class="btn-filtrar" style="padding: 8px;">
                    Filtrar
                </button>
            </div>
        </div>

    </form>

    <!-- Tabela de Usuários -->
    <table class="tabela-scroll">
        <thead>
        <tr>
            <th>Nome</th>
            <th>Email</th>
            <th>CPF</th>
            <th>Raça</th>
            <th>Data de Nascimento</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="usuario : ${usuarios}">
            <td th:text="${usuario.nome}">Nome</td>
            <td th:text="${usuario.email}">Email</td>
            <td th:text="${usuario.cpf}">CPF</td>
            <td th:text="${usuario.raca}">Raça</td>
            <td th:text="${#dates.format(usuario.dataNasc, 'dd/MM/yyyy')}">Data</td>
            <td>
                <!-- Botão que abre dropdown -->
                <div class="dropdown">
                    <button onclick="toggleDropdown('dropdown-[[${usuario.id}]]')" class="dropbtn">▼</button>
                    <div id="dropdown-[[${usuario.id}]]" class="dropdown-content">
                        <a href="#" onclick="openModal('modal-edit-[[${usuario.id}]]'); closeDropdown('dropdown-[[${usuario.id}]]'); return false;">
                            <img src="/images/edit.svg" alt="Editar" class="icon"> Editar
                        </a>
                        <a href="#" onclick="openModal('modal-delete-[[${usuario.id}]]'); closeDropdown('dropdown-[[${usuario.id}]]'); return false;">
                            <img src="/images/delete.svg" alt="Excluir" class="icon"> Excluir
                        </a>
                    </div>
                </div>

                <!-- Modal Editar -->
                <div id="modal-edit-[[${usuario.id}]]" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal('modal-edit-[[${usuario.id}]]')">&times;</span>
                        <h2>Editar Usuário [[${usuario.nome}]]</h2>
                        <!-- Formulário de edição aqui -->
                    </div>
                </div>

                <!-- Modal Excluir -->
                <div id="modal-delete-[[${usuario.id}]]" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal('modal-delete-[[${usuario.id}]]')">&times;</span>
                        <h2>Excluir Usuário [[${usuario.nome}]]</h2>
                        <p>Tem certeza que deseja excluir?</p>
                        <button>Confirmar</button>
                        <button onclick="closeModal('modal-delete-[[${usuario.id}]]')">Cancelar</button>
                    </div>
                </div>
            </td>
        </tr>
        <tr th:if="${usuarios.size() == 0}">
            <td colspan="5">Nenhum usuário encontrado.</td>
        </tr>
        </tbody>
    </table>
</div>
</body>
<script>
    function toggleDropdown(id) {
        const el = document.getElementById(id);
        if (!el) return;
        const isVisible = el.style.display === 'block';
        closeAllDropdowns();
        el.style.display = isVisible ? 'none' : 'block';
    }

    function closeDropdown(id) {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
    }

    function closeAllDropdowns() {
        document.querySelectorAll('.dropdown-content').forEach(dc => {
            dc.style.display = 'none';
        });
    }

    window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {
            closeAllDropdowns();
        }
    };

    function openModal(id) {
        const modal = document.getElementById(id);
        if (modal) modal.style.display = 'block';
    }

    function closeModal(id) {
        const modal = document.getElementById(id);
        if (modal) modal.style.display = 'none';
    }
</script>
</html>